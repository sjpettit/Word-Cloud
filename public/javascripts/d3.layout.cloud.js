(function(P){function Q(a){return a.text}function R(){return"serif"}function S(a){return Math.sqrt(a.value)}function T(){return 30*(~~(6*Math.random())-3)}function U(){return 1}function F(a){var m=a[0]/a[1];return function(a){return[m*(a*=.1)*Math.cos(a),a*Math.sin(a)]}}function V(a){for(var m=[],g=-1;++g<a;)m[g]=0;return m}var I=Math.PI/180,d,m=1;"undefined"!==typeof document?(d=document.createElement("canvas"),d.width=1,d.height=1,m=Math.sqrt(d.getContext("2d").getImageData(0,0,1,1).data.length>>
2),d.width=2048/m,d.height=2048/m):d=new (require("canvas"))(2048,2048);var q=d.getContext("2d"),W={archimedean:F,rectangular:function(a){var m=4*a[0]/a[1],g=0,q=0;return function(a){var d=0>a?-1:1;switch(Math.sqrt(1+4*d*a)-d&3){case 0:g+=m;break;case 1:q+=4;break;case 2:g-=m;break;default:q-=4}return[g,q]}}};q.fillStyle="red";q.textAlign="center";P.cloud=function(){var a=[256,256],d=Q,g=R,A=S,J=T,D=U,K=F,z=[],L=Infinity,M=d3.dispatch("word","end"),B=null,v={start:function(){function G(){for(var G=
+new Date,f;+new Date-G<L&&++H<D&&B;){f=N[H];f.x=a[0]*(Math.random()+.5)>>1;f.y=a[1]*(Math.random()+.5)>>1;a:{var b=f,c=N,n=H;if(!b.sprite){q.clearRect(0,0,2048/m,2048/m);var t=0,d=0,g=0,l=c.length;for(n--;++n<l;){b=c[n];q.save();q.font=~~((b.size+1)/m)+"px "+b.font;var k=q.measureText(b.text+"m").width*m,r=b.size<<1;if(b.rotate)var h=Math.sin(b.rotate*I),w=Math.cos(b.rotate*I),e=k*w,p=k*h,w=r*w,k=r*h,k=Math.max(Math.abs(e+k),Math.abs(e-k))+31>>5<<5,r=~~Math.max(Math.abs(p+w),Math.abs(p-w));else k=
k+31>>5<<5;r>g&&(g=r);2048<=t+k&&(t=0,d+=g,g=0);if(2048<=d+r)break;q.translate((t+(k>>1))/m,(d+(r>>1))/m);b.rotate&&q.rotate(b.rotate*I);q.fillText(b.text,0,0);q.restore();b.width=k;b.height=r;b.xoff=t;b.yoff=d;b.x1=k>>1;b.y1=r>>1;b.x0=-b.x1;b.y0=-b.y1;t+=k}g=q.getImageData(0,0,2048/m,2048/m).data;for(l=[];0<=--n;){b=c[n];k=b.width;e=k>>5;r=b.y1-b.y0;p=b.padding;for(h=0;h<r*e;h++)l[h]=0;t=b.xoff;if(null==t)break a;for(var d=b.yoff,w=0,z=-1,y=0;y<r;y++){for(h=0;h<k;h++){var u=e*y+(h>>5),x=g[2048*(d+
y)+(t+h)<<2]?1<<31-h%32:0;p&&(y&&(l[u-e]|=x),y<k-1&&(l[u+e]|=x),x=x|x<<1|x>>1);l[u]|=x;w|=x}w?z=y:(b.y0++,r--,y--,d++)}b.y1=b.y0+z;b.sprite=l.slice(0,(b.y1-b.y0)*e)}}}a:{b=F;c=f;n=C;t=c.x;d=c.y;k=Math.sqrt(a[0]*a[0]+a[1]*a[1]);r=K(a);g=.5>Math.random()?1:-1;l=-g;for(p=e=p=void 0;p=r(l+=g);){e=~~p[0];p=~~p[1];if(Math.min(e,p)>k)break;c.x=t+e;c.y=d+p;if(!(e=0>c.x+c.x0||0>c.y+c.y0||c.x+c.x1>a[0]||c.y+c.y1>a[1])&&(e=n))b:{for(var e=a[0],e=e>>5,p=c.sprite,h=c.width>>5,u=c.x-(h<<4),w=u&127,z=32-w,y=c.y1-
c.y0,u=(c.y+c.y0)*e+(u>>5),x=void 0,A=0;A<y;A++){for(var E=x=0;E<=h;E++)if((x<<z|(E<h?(x=p[A*h+E])>>>w:0))&b[u+E]){e=!0;break b}u+=e}e=!1}if(!e&&(!n||c.x+c.x1>n[0].x&&c.x+c.x0<n[1].x&&c.y+c.y1>n[0].y&&c.y+c.y0<n[1].y)){n=c.sprite;t=c.width>>5;d=a[0]>>5;l=c.x-(t<<4);k=l&127;r=32-k;g=c.y1-c.y0;l=(c.y+c.y0)*d+(l>>5);for(p=0;p<g;p++){for(h=e=0;h<=t;h++)b[l+h]=b[l+h]|e<<r|(h<t?(e=n[p*t+h])>>>k:0);l+=d}delete c.sprite;b=!0;break a}}b=!1}b&&(O.push(f),M.word(f),C?(b=f,c=C[0],n=C[1],b.x+b.x0<c.x&&(c.x=b.x+
b.x0),b.y+b.y0<c.y&&(c.y=b.y+b.y0),b.x+b.x1>n.x&&(n.x=b.x+b.x1),b.y+b.y1>n.y&&(n.y=b.y+b.y1)):C=[{x:f.x+f.x0,y:f.y+f.y0},{x:f.x+f.x1,y:f.y+f.y1}],f.x-=a[0]>>1,f.y-=a[1]>>1)}H>=D&&(v.stop(),M.end(O,C))}var F=V((a[0]>>5)*a[1]),C=null,D=z.length,H=-1,O=[],N=z.map(function(a,f){return{text:d.call(this,a,f),font:g.call(this,a,f),rotate:J.call(this,a,f),size:~~A.call(this,a,f),padding:1}}).sort(function(a,d){return d.size-a.size});B&&clearInterval(B);B=setInterval(G,0);G();return v},stop:function(){B&&
(clearInterval(B),B=null);return v},timeInterval:function(a){if(!arguments.length)return L;L=null==a?Infinity:a;return v},words:function(a){if(!arguments.length)return z;z=a;return v},size:function(d){if(!arguments.length)return a;a=[+d[0],+d[1]];return v},font:function(a){if(!arguments.length)return g;g=d3.functor(a);return v},rotate:function(a){if(!arguments.length)return J;J=d3.functor(a);return v},text:function(a){if(!arguments.length)return d;d=d3.functor(a);return v},spiral:function(a){if(!arguments.length)return K;
K=W[a+""]||a;return v},fontSize:function(a){if(!arguments.length)return A;A=d3.functor(a);return v},padding:function(a){if(!arguments.length)return D;D=d3.functor(a);return v}};return d3.rebind(v,M,"on")}})("undefined"===typeof exports?d3.layout||(d3.layout={}):exports);